!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react"),require("baconjs"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","react","baconjs","infestines"],n):n(r.baret={},r.React,r.Bacon,r.I)}(this,function(r,n,e,t){"use strict";function i(r,n,e){if(E(r))return e[++n[0]];if(t.isArray(r)){for(var s=r,u=0,a=r.length;u<a;++u){var o=r[u],l=o;E(o)?l=e[++n[0]]:t.isArray(o)&&(l=i(o,n,e)),l!==o&&(s===r&&(s=r.slice(0)),s[u]=l)}return s}return r}function s(r,n,e){var t=void 0;for(var i in r){var s=r[i];if(E(s)){if(!t){t={};for(var u in r){if(u===i)break;t[u]=r[u]}}t[i]=e[++n[0]]}else t&&(t[i]=s)}return t||r}function u(r,n){var e=null,t=null,u=null,a=[-1];for(var o in r){var l=r[o];y===o?u=i(l,a,n):"$$type"===o?e=r[o]:A===o?(t=t||{}).ref=E(l)?n[++a[0]]:l:E(l)?(t=t||{})[o]=n[++a[0]]:p===o?(t=t||{}).style=s(l,a,n)||l:(t=t||{})[o]=l}return u instanceof Array?g.apply(null,[e,t].concat(u)):u?g(e,t,u):g(e,t)}function a(r,n,e){for(var i=0,s=r.length;i<s;++i){var u=r[i];E(u)?e(n,u):t.isArray(u)&&a(u,n,e)}}function o(r,n,e){for(var i in r){var s=r[i];if(E(s))e(n,s);else if(y===i)t.isArray(s)&&a(s,n,e);else if(p===i)for(var u in s){var o=s[u];E(o)&&e(n,o)}}}function l(r){r.values+=1}function f(r,n){r.unsub=n.subscribe(r)}function c(r,n){var e=function n(e){for(var t=r.handlers,i=0;t[i]!==n;)++i;if(e.hasValue()){var s=e.value(),u=r.values;u[i]!==s&&(u[i]=s,r.forceUpdate())}else{if(e.isError())throw e.error;t[i]=null;var a=t.length;if(a!==r.values.length)return;for(var o=0;o<a;++o)if(t[o])return;r.handlers=null}};r.handlers.push(e),e.unsub=n.subscribe(e)}function h(r){r&&r.unsub()}function v(r,n){for(var e=n.length;r<e;++r){var i=n[r];if(E(i)||t.isArray(i)&&v(0,i))return!0}return!1}function d(r){for(var n in r){var e=r[n];if(E(e))return!0;if(y===n){if(t.isArray(e)&&v(0,e))return!0}else if(p===n)for(var i in e)if(E(e[i]))return!0}return!1}function b(r,n){var e={$$type:r};for(var t in n){var i=n[t];"ref"===t?e[A]=i:m!==t&&(e[t]=i)}return e}var p="style",y="children",m="baret-lift",A="$$ref",g=(n=n&&n.hasOwnProperty("default")?n.default:n).createElement,U=n.Component,E=function(r){return r instanceof e.Observable},j=t.inherit(function(r){U.call(this,r)},U,{componentWillReceiveProps:function(r){this.componentWillUnmount(),this.doSubscribe(r)},componentWillMount:function(){this.doSubscribe(this.props)}}),$=t.inherit(function(r){j.call(this,r),this.callback=null,this.rendered=null},j,{componentWillUnmount:function(){this.unsub&&this.unsub()},doSubscribe:function(r){var n=this,e=r.observable;if(E(e)){this.unsub=e.subscribe(function(r){if(r.hasValue())n.rendered=r.value()||null,n.forceUpdate();else{if(r.isError())throw r.error;r.isEnd()&&(n.unsub=null)}})}else this.rendered=e||null},render:function(){return this.rendered}}),w=t.inherit(function(r){j.call(this,r),this.values=this,this.handlers=null},j,{componentWillUnmount:function(){var r=this.handlers;r instanceof Function?r.unsub():r&&r.forEach(h)},doSubscribe:function(r){var n=this;this.values=0,o(r,this,l);var e=this.values;switch(e){case 0:this.values=t.array0;break;case 1:this.values=this;var i=function(r){if(r.hasValue()){var e=r.value();n.values!==e&&(n.values=e,n.forceUpdate())}else{if(r.isError())throw r.error;n.values=[n.values],n.handlers=null}};this.handlers=i,o(r,i,f);break;default:this.values=Array(e).fill(this),this.handlers=[],o(r,this,c)}},render:function(){if(this.handlers instanceof Function){var r=this.values;return r===this?null:u(this.props,[r])}for(var n=this.values,e=0,t=n.length;e<t;++e)if(n[e]===this)return null;return u(this.props,n)}}),P=t.assocPartialU("createElement",function(){for(var r=arguments.length,n=Array(r),e=0;e<r;e++)n[e]=arguments[e];var i=n[0],s=n[1]||t.object0;return(t.isString(i)||s[m])&&(v(2,n)||d(s)?(n[1]=b(i,s),n[0]=w):s[m]&&(n[1]=t.dissocPartialU(m,s)||t.object0)),g.apply(void 0,n)},n);r.fromBacon=function(r){return g($,{observable:r})},r.default=P,r.fromClass=function(r){return function(n){return g(w,b(r,n))}},Object.defineProperty(r,"__esModule",{value:!0})});
